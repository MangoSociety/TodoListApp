name: Telegram Notification
on:
  push:
  pull_request:
    types: [opened, reopened, synchronize]
jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v2
    - name: Get commit details
      id: commit
      run: |
        echo "::set-output name=message::$(git log --format=%B -n 1 ${{ github.sha }} | head -n 3)"
        echo "::set-output name=author::$(git log --format=%an -n 1 ${{ github.sha }})"
    - name: Send Telegram Message for Push
      if: github.event_name == 'push'
      uses: appleboy/telegram-action@master
      with:
        to: ${{ secrets.TELEGRAM_CHAT_ID }}
        token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        message: |
          üöÄ –ù–æ–≤—ã–π –∫–æ–º–º–∏—Ç –≤ –≤–µ—Ç–∫–µ *${{ github.ref_name }}*!
          
          –ê–≤—Ç–æ—Ä: ${{ steps.commit.outputs.author }}
          –°–æ–æ–±—â–µ–Ω–∏–µ: 
            ${{ steps.commit.outputs.message }}
            
            https://github.com/${{ github.repository }}/commit/${{ github.sha }}
    - name: Send Telegram Message for Pull Request
      if: github.event_name == 'pull_request'
      uses: appleboy/telegram-action@master
      with:
        to: ${{ secrets.TELEGRAM_CHAT_ID }}
        token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        message: |
          üì• ${{ github.event.action == 'opened' && '–ù–æ–≤—ã–π' || '–û–±–Ω–æ–≤–ª–µ–Ω' }} –ø—É–ª–ª-—Ä–µ–∫–≤–µ—Å—Ç!
          
          –ù–∞–∑–≤–∞–Ω–∏–µ: ${{ github.event.pull_request.title }}
          –ê–≤—Ç–æ—Ä: ${{ github.event.pull_request.user.login }}
          –ò–∑: ${{ github.head_ref }}` ‚Üí –í: `${{ github.base_ref }}
          https://github.com/${{ github.repository }}/pull/${{ github.event.pull_request.number }}
